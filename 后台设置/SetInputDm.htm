<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=gb2312">
<meta name=ProgId content=Word.Document>
<title>无标题文档</title>

<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:宋体;
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-alt:SimSun;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 680460288 22 0 262145 0;}
@font-face
	{font-family:"\@宋体";
	panose-1:2 1 6 0 3 1 1 1 1 1;
	mso-font-charset:134;
	mso-generic-font-family:auto;
	mso-font-pitch:variable;
	mso-font-signature:3 680460288 22 0 262145 0;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{mso-style-parent:"";
	margin:0cm;
	margin-bottom:.0001pt;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;}
a:link, span.MsoHyperlink
	{color:blue;
	text-decoration:underline;
	text-underline:single;}
a:visited, span.MsoHyperlinkFollowed
	{color:purple;
	text-decoration:underline;
	text-underline:single;}
p
	{mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;}
p.style1, li.style1, div.style1
	{mso-style-name:style1;
	mso-margin-top-alt:auto;
	margin-right:0cm;
	mso-margin-bottom-alt:auto;
	margin-left:0cm;
	mso-pagination:widow-orphan;
	font-size:12.0pt;
	font-family:宋体;
	mso-bidi-font-family:宋体;
	color:blue;
	font-weight:bold;}
span.style11
	{mso-style-name:style11;
	color:blue;
	font-weight:bold;}
span.GramE
	{mso-style-name:"";
	mso-gram-e:yes;}
@page Section1
	{size:595.3pt 841.9pt;
	margin:72.0pt 90.0pt 72.0pt 90.0pt;
	mso-header-margin:42.55pt;
	mso-footer-margin:49.6pt;
	mso-paper-source:0;}
div.Section1
	{page:Section1;}
-->
</style>

</head>

<body lang=ZH-CN link=blue vlink=purple style='tab-interval:21.0pt'>

<div class=Section1>

<p class=style1><span style='font-size:13.5pt'>函数简介<span lang=EN-US>:</span></span></p>

<p><span style='font-size:13.5pt'>设置当前对象用于输入的对象<span lang=EN-US>. </span><span
style='color:fuchsia'>结合图<span class=GramE>色对象</span>和<span class=GramE>键鼠</span>对象<span
lang=EN-US>,</span>用一个对象完成操作<span lang=EN-US>.</span></span><span lang=EN-US></span></span></p>

<p><span class=style11><span style='font-size:13.5pt'>函数原型<span lang=EN-US>:</span></span></span><span
lang=EN-US style='font-size:13.5pt'><br>
<br>
<span class=GramE>long</span> SetInputDm(dm_id,rx,ry)</span></p>

<p style='margin-bottom:13.5pt'><span class=style11><span style='font-size:
13.5pt'>参数定义<span lang=EN-US>:</span></span><span lang=EN-US></span></span></p>

<p style='margin-bottom:13.5pt'><span lang=EN-US style='font-size:13.5pt'>dm_id
</span><span style='font-size:13.5pt;color:maroon'>整形数</span><span lang=EN-US
style='font-size:13.5pt'>: </span><span style='font-size:13.5pt'>接口<span
lang=EN-US>GetId</span>的返回值<span lang=EN-US><br>
rx </span><span style='color:maroon'>整形数</span><span lang=EN-US>: </span>两个对象绑定的窗口的左上角坐标的<span
lang=EN-US>x</span>偏移<span lang=EN-US>. </span>是用<span lang=EN-US>dm_id</span>对应的窗口的左上角<span
lang=EN-US>x</span>坐标减去当前窗口左上角坐标的<span lang=EN-US>x</span>坐标<span lang=EN-US>. </span>一般是<span
lang=EN-US>0<br>
ry </span><span style='color:maroon'>整形数</span><span lang=EN-US>: </span>两个对象绑定的窗口的左上角坐标的<span
lang=EN-US>y</span>偏移<span lang=EN-US>. </span>是用<span lang=EN-US>dm_id</span>对应的窗口的左上角<span
lang=EN-US>y</span>坐标减去当前窗口左上角坐标的<span lang=EN-US>y</span>坐标<span lang=EN-US>. </span>一般是<span
lang=EN-US>0</span></span></p>

<p><span class=style11><span style='font-size:13.5pt'>返回值<span lang=EN-US>:</span></span></span><span
lang=EN-US style='font-size:13.5pt'></span></p>

<p><span style='font-size:13.5pt;color:maroon'>整形数<span lang=EN-US>:</span></span><span
lang=EN-US style='font-size:13.5pt'><br>
0: </span><span style='font-size:13.5pt'>失败<span lang=EN-US><br>
1: </span>成功<span lang=EN-US></span></span></p>

<p><span class=style11><span style='font-size:13.5pt'>示例<span lang=EN-US>:</span></span></span><span
lang=EN-US style='font-size:13.5pt'></span></p>

<p><span lang=EN-US style='font-size:13.5pt'>// </span><span style='font-size:
13.5pt'>创建<span lang=EN-US>2</span>个对象<span lang=EN-US><br>
set dm = createobject(&quot;dm.dmsoft&quot;)<br>
set dm2 = createobject(&quot;dm.dmsoft&quot;)<br>
<br>
dm.SetPath dm.GetBasePath()<br>
hwnd = dm.FindWindowSuper(&quot;sub&quot;,0,1,&quot;subWin&quot;,2,1)<br>
hwnd2 = dm.GetWindow(hwnd,0)<br>
<br>
// </span>两个对象分别绑定对应的窗口<span lang=EN-US><br>
dm_ret = dm.BindWindowEx(hwnd,&quot;dx.graphic.opengl&quot;,&quot;windows&quot;,&quot;windows&quot;,&quot;&quot;,0)<br>
dm_ret2 =
dm2.BindWindowEx(hwnd2,&quot;normal&quot;,&quot;dx.mouse.position.lock.api&quot;,&quot;dx.keypad.input.lock.api&quot;,&quot;&quot;,0)<br>
TracePrint dm_ret<br>
TracePrint dm_ret2<br>
<br>
// dm</span>用于图色<span lang=EN-US> dm2</span><span class=GramE>用于键鼠</span><span
lang=EN-US>. </span>结合起来<span lang=EN-US>. </span>让<span lang=EN-US>dm</span>同时处理图色和<span
class=GramE>键鼠</span><span lang=EN-US><br>
TracePrint dm.SetInputDm(dm2.GetId(),0,0)<br>
<br>
// </span>正常进行处理<span lang=EN-US>.</span><span class=GramE>比如找图</span> 找字等等<span
lang=EN-US>.<br>
dm_ret =
dm.FindPic(0,0,2000,2000,&quot;test.bmp&quot;,&quot;000000&quot;,0.9,0,x,y)<br>
TracePrint cstr(x)<br>
if x &gt; 0 then<br>
<span style='mso-tab-count:1'>&nbsp;&nbsp; </span>dm.MoveTo x,y<br>
<span style='mso-tab-count:1'>&nbsp;&nbsp; </span>delay 100<br>
<span style='mso-tab-count:1'>&nbsp;&nbsp; </span>dm.LeftClick<br>
end if<br>
<br>
...<br>
<br>
// </span>解绑<span lang=EN-US><br>
dm.UnBindWindow<br>
dm2.UnBindWindow</span></span></p>

<p><span style='font-size:13.5pt;color:fuchsia'>注<span lang=EN-US>: </span>此接口用于特殊用途<span
lang=EN-US>. <br>
</span>比如雷电模拟器<span lang=EN-US>. </span>最里层的窗口是一个<span lang=EN-US>64</span>位窗口<span
lang=EN-US>. </span>绑定这个窗口的图色可以<span class=GramE>用来图</span>色后台<span lang=EN-US>.
</span>但是这个窗口无法<span class=GramE>进行键鼠后台</span><span lang=EN-US>.<br>
</span><span class=GramE>能够键鼠窗口</span>后台的是这个窗口的上一层<span lang=EN-US>32</span>位窗口<span
lang=EN-US>.</span>但这个<span lang=EN-US>32</span>位窗口在某些情况下图色会出问题<span
lang=EN-US>.<br>
</span>所以比较好的解决办法是创建<span lang=EN-US>2</span>个对象<span lang=EN-US>. </span>一个绑定<span
lang=EN-US>64</span>位的窗口，用来进行图<span class=GramE>色使用</span><span lang=EN-US>. </span>另一个绑定<span
lang=EN-US>32</span>位的窗口<span lang=EN-US>,</span>用来进行<span class=GramE>键鼠操作</span><span
lang=EN-US>.</span></span></p>

<p><span style='font-size:13.5pt;color:fuchsia'>但是如果对于写好的代码来说<span lang=EN-US>,</span>更改起来很麻烦<span
lang=EN-US>. </span>因为大部分情况下一个对象就够用了<span lang=EN-US>.</span>为了让代码不用大幅度更改<span
lang=EN-US>,</span>就加了这样一个接口<span lang=EN-US>.<br>
</span>让进行图色绑定的那个对象和进行<span class=GramE>键鼠操作</span>的那个对象结合起来<span lang=EN-US>. </span>这样只用操作一个图色绑定的对象就行了<span
lang=EN-US>.<br>
<br>
</span>这里要注意的是<span lang=EN-US>,</span>如果<span lang=EN-US>2</span>个对象对应的窗口不是一个进程<span
lang=EN-US>,</span>那么绑定参数上没什么要求<span lang=EN-US>. </span>如果是一个进程<span
lang=EN-US>,</span>那么必须保证只有一个对象能够使用注入的参数<span lang=EN-US>.</span>否则会引发冲突导致崩溃<span
lang=EN-US>.<br>
</span>还有<span lang=EN-US>rx</span>和<span lang=EN-US>ry</span>的具体含义<span
lang=EN-US>. </span>解释如下<span lang=EN-US>:<br>
</span>一般来说<span lang=EN-US>,</span>我们调用<span lang=EN-US>MoveTo</span>或者<span
lang=EN-US>MoveToEx</span>时<span lang=EN-US>,</span>传递进来的<span lang=EN-US>x</span>和<span
lang=EN-US>y</span>坐标都是来自于图色窗口<span lang=EN-US>,</span><span class=GramE>但是键鼠操作</span>的那个窗口是另一个窗口<span
lang=EN-US>. </span>如果这<span lang=EN-US>2</span>个窗口左上角是重合的<span lang=EN-US>,</span>那么无所谓<span
lang=EN-US><br>
rx</span>和<span lang=EN-US>ry</span>就是<span lang=EN-US>0. </span>比如我们这里的雷电模拟器等窗口<span
lang=EN-US>.<br>
</span>但是如果不重合<span lang=EN-US>,</span>那么我们传递给<span lang=EN-US>MoveTo</span>或者<span
lang=EN-US>MoveToEx</span>的<span lang=EN-US>x</span>和<span lang=EN-US>y</span>就和<span
class=GramE>键鼠</span>操作的窗口的<span lang=EN-US>x</span>和<span lang=EN-US>y</span>不对应<span
lang=EN-US>. </span>所以就必须从图色的<span lang=EN-US>x,y</span>减去两个窗口的左上角偏移<span
lang=EN-US>,</span>这样才能对应<span class=GramE>键鼠操作</span>的窗口<span lang=EN-US>.</span></span></p>

<p><span style='font-size:13.5pt;color:fuchsia'>一般来说<span lang=EN-US>,rx</span>和<span
lang=EN-US>ry</span>都是<span lang=EN-US>0. </span>可能有极少数有这种不为<span lang=EN-US>0</span>的特例<span
lang=EN-US>(</span>我是暂时没发现<span lang=EN-US>). </span>这里的<span lang=EN-US>rx</span>和<span
lang=EN-US>ry</span>必须是<span class=GramE>键鼠操作</span>的窗口左上角减去图色窗口的左上角<span
lang=EN-US>,</span>不能是反的<span lang=EN-US>.</span></span></p>

<p><span style='font-size:13.5pt;color:fuchsia'>另外在解绑时<span lang=EN-US>,</span>会自动重置<span
lang=EN-US>. </span>即图色窗口的对象自动和<span class=GramE>键鼠</span>窗口的对象脱离<span
lang=EN-US>. <br>
</span>需要注意的是<span lang=EN-US>,</span>因为两个对象进行了结合<span lang=EN-US>,</span>那么就要确保两个对象的生命周期必须是一致的<span
lang=EN-US>. </span>尤其千万不能在图色窗口操作时<span lang=EN-US>,</span><span class=GramE>键鼠对象</span>被释放了<span
lang=EN-US>. </span>那么会导致程序的崩溃<span lang=EN-US>.</span></span></p>

<p><span style='font-size:13.5pt;color:fuchsia'>这个接口影响的输入接口如下列表<span
lang=EN-US>(</span>即图<span class=GramE>色对象</span>调用了<span lang=EN-US>SetDmInput</span>后<span
lang=EN-US>,</span>以下这些接口统统都是<span class=GramE>对键鼠对象</span>的调用<span lang=EN-US>)</span></span></p>

<p><span lang=EN-US style='font-size:13.5pt'>GetCursorPos<span
style='color:fuchsia'><br>
</span>GetCursorShape<br>
GetCursorShapeEx<br>
GetCursorSpot<br>
KeyDown<br>
KeyDownChar<br>
KeyPress<br>
KeyPressChar<br>
KeyPressStr<br>
KeyUp<br>
KeyUpChar<br>
LeftClick<br>
LeftDoubleClick<br>
LeftDown<br>
LeftUp<br>
MiddleClick<br>
MiddleDown<br>
MiddleUp<br>
MoveR<br>
MoveTo<br>
MoveToEx<br>
RightClick<br>
RightDown<br>
RightUp<br>
SetKeypadDelay<br>
SetMouseDelay<span style='color:fuchsia'><br>
</span>SetSimMode<br>
WheelDown<br>
WheelUp<br>
<br>
EnableFakeActive<br>
EnableKeypadMsg<br>
EnableKeypadPatch<br>
EnableKeypadSync<br>
EnableMouseMsg<br>
EnableMouseSync<br>
EnableRealKeypad<br>
EnableRealMouse<br>
EnableSpeedDx<br>
LockInput<span style='color:fuchsia'></span></span></p>

</div>

</body>

</html>
